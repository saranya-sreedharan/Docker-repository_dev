<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=5,IE=9" ><![endif]-->
<!DOCTYPE html>
<html>
<head>
<title>Private_docker_repo</title>
<meta charset="utf-8"/>
</head>
<body><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2024-03-29T10:01:19.401Z\&quot; agent=\&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36\&quot; etag=\&quot;cylN3QPrY7fhKMvRSUmR\&quot; version=\&quot;24.2.1\&quot; type=\&quot;google\&quot;&gt;\n  &lt;diagram name=\&quot;Page-1\&quot; id=\&quot;2T3OXjTwnzfZ0_f7YEvn\&quot;&gt;\n    &lt;mxGraphModel dx=\&quot;1150\&quot; dy=\&quot;466\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;850\&quot; pageHeight=\&quot;1100\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;&gt;\n      &lt;root&gt;\n        &lt;mxCell id=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;FgjHH_AWDl7wLQwdKiXT-1\&quot; value=\&quot;sudo apt update\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;50\&quot; y=\&quot;70\&quot; width=\&quot;290\&quot; height=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;UserObject label=\&quot;#!/bin/bash&amp;#xa;&amp;#xa;&amp;#xa;#This script is used to create private docker repository in ubuntu 20.04 ec2 instance&amp;#xa;#Run this sctript with sudo permissions ( sudo su)&amp;#xa;&amp;#xa;&amp;#xa;RED=&amp;#39;\\033[0;31m&amp;#39;  # Red colored text&amp;#xa;NC=&amp;#39;\\033[0m&amp;#39;      # Normal text&amp;#xa;YELLOW=&amp;#39;\\033[33m&amp;#39;  # Yellow Color&amp;#xa;GREEN=&amp;#39;\\033[32m&amp;#39;   # Green Color&amp;#xa;&amp;#xa;&amp;#xa;if [ &amp;quot;$(id -u)&amp;quot; -ne 0 ]; then&amp;#xa;    echo &amp;quot;Error: This script must be run as root&amp;quot; &amp;gt;&amp;amp;2&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo &amp;quot;Enter the Domain_name:&amp;quot;&amp;#xa;read -r domain_name&amp;#xa;#password=&amp;quot;your_password_here&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}... updating packages${NC}&amp;quot;&amp;#xa;# Update package information&amp;#xa;if ! sudo apt update; then&amp;#xa;    echo -e &amp;quot;${RED}The system update failed.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Check if Docker is installed&amp;#xa;if [ -x &amp;quot;$(command -v docker)&amp;quot; ]; then&amp;#xa;    echo &amp;quot;${GREEN}Docker is already installed.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    # Install Docker&amp;#xa;    echo -e &amp;quot;${YELLOW}Installing Docker...${NC}&amp;quot;&amp;#xa;    sudo apt-get update&amp;#xa;    sudo apt-get install -y docker.io&amp;#xa;    if ! [ -x &amp;quot;$(command -v docker)&amp;quot; ]; then&amp;#xa;        echo -e &amp;quot;${RED}Docker installation failed.${NC}&amp;quot;&amp;#xa;        exit 1&amp;#xa;    else&amp;#xa;        echo &amp;quot;${GREEN}Docker is successfully installed.${NC}&amp;quot;&amp;#xa;    fi&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...checking the docker is running successfully or not...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Check if Docker is running&amp;#xa;if sudo systemctl is-active --quiet docker; then&amp;#xa;    echo &amp;quot;${GREEN}Docker is running.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    # Start Docker&amp;#xa;    echo &amp;quot;${YELLOW}Starting Docker...${NC}&amp;quot;&amp;#xa;    sudo systemctl start docker&amp;#xa;    sudo systemctl enable docker&amp;#xa;    if [ $? -eq 0 ]; then&amp;#xa;        echo -e &amp;quot;${GREEN}Docker Successfully started.${NC}&amp;quot;&amp;#xa;    else&amp;#xa;        echo -e &amp;quot;${RED}Docker Failed to start.${NC}&amp;quot;&amp;#xa;        exit 1&amp;#xa;    fi&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...configuring the docker daemon.json...${NC}&amp;quot;&amp;#xa;# Configure Docker daemon&amp;#xa;if ! sudo bash -c &amp;quot;cat &amp;lt;&amp;lt;EOL &amp;gt; /etc/docker/daemon.json&amp;#xa;{&amp;#xa;  \\&amp;quot;insecure-registries\\&amp;quot;: [\\&amp;quot;$domain_name\\&amp;quot;]&amp;#xa;}&amp;#xa;EOL&amp;quot;; then&amp;#xa;    echo -e &amp;quot;${RED}The Docker daemon configuration failed.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...restarting the docker...${NC}&amp;quot;&amp;#xa;# Restart Docker&amp;#xa;if ! sudo systemctl restart docker; then&amp;#xa;    echo -e &amp;quot;${RED}Failed to restart Docker after modifying the daemon.json.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...Installing Certbot and its Nginx plugin${NC}&amp;quot;&amp;#xa;if ! sudo apt install -y certbot python3-certbot-nginx; then &amp;#xa;    echo -e &amp;quot;${RED}Package installation failed.${NC}&amp;quot;&amp;#xa;    echo -e &amp;quot;${RED}Please check the error message above for more details.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;sudo certbot certonly --nginx --email saranyasreedharan23@gmail.com --agree-tos --eff-email -d $domain_name&amp;#xa;#sudo certbot certonly --nginx --email saranyasreedharan23@gmail.com --agree-tos --eff-email -d sr6.mnserviceproviders.com&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...updating the system...${NC}&amp;quot;&amp;#xa;if ! sudo apt update; then&amp;#xa;  echo -e &amp;quot;${RED}System update failed.${NC}&amp;quot;&amp;#xa;  exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...installing the docker-compose...${NC}&amp;quot;&amp;#xa;if ! sudo apt install -y docker-compose; then &amp;#xa;  echo -e &amp;quot;${RED}Failed to install Docker Compose.${NC}&amp;quot;&amp;#xa;  exit 1&amp;#xa;else&amp;#xa;  echo -e &amp;quot;${GREEN}Docker Compose successfully installed.${NC}&amp;quot;&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Creating directories...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Create the &amp;#39;registry&amp;#39; directory&amp;#xa;mkdir -p registry&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}&amp;#39;registry&amp;#39; directory created.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create &amp;#39;registry&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Move into the &amp;#39;registry&amp;#39; directory&amp;#xa;cd registry&amp;#xa;if [ $? -ne 0 ]; then&amp;#xa;    echo -e &amp;quot;${RED}Failed to navigate to &amp;#39;registry&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Create the &amp;#39;auth&amp;#39; directory&amp;#xa;mkdir auth&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}&amp;#39;auth&amp;#39; directory created.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create &amp;#39;auth&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Create the &amp;#39;nginx&amp;#39; directory&amp;#xa;mkdir nginx&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}&amp;#39;nginx&amp;#39; directory created.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create &amp;#39;nginx&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Move into the &amp;#39;nginx&amp;#39; directory&amp;#xa;cd nginx&amp;#xa;if [ $? -ne 0 ]; then&amp;#xa;    echo -e &amp;quot;${RED}Failed to navigate to &amp;#39;nginx&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Create the &amp;#39;conf.d&amp;#39; directory&amp;#xa;mkdir conf.d&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}&amp;#39;conf.d&amp;#39; directory created.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create &amp;#39;conf.d&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Create the &amp;#39;ssl&amp;#39; directory&amp;#xa;mkdir ssl&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}&amp;#39;ssl&amp;#39; directory created.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create &amp;#39;ssl&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;cd .. || exit 1&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Creating docker-compose.yml...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Create docker-compose.yml using nano&amp;#xa;cat &amp;lt;&amp;lt;EOL &amp;gt; docker-compose.yml&amp;#xa;version: &amp;#39;3&amp;#39;&amp;#xa;services:&amp;#xa;#Registry&amp;#xa;  registry:&amp;#xa;    image: registry:2&amp;#xa;    restart: always&amp;#xa;    ports:&amp;#xa;    - &amp;quot;5000:5000&amp;quot;&amp;#xa;    environment:&amp;#xa;      REGISTRY_AUTH: htpasswd&amp;#xa;      REGISTRY_AUTH_HTPASSWD_REALM: Registry-Realm&amp;#xa;      REGISTRY_AUTH_HTPASSWD_PATH: /auth/registry.passwd&amp;#xa;      REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY: /data&amp;#xa;    volumes:&amp;#xa;      - registrydata:/data&amp;#xa;      - ./auth:/auth&amp;#xa;    networks:&amp;#xa;      - mynet&amp;#xa;#Nginx Service&amp;#xa;  nginx:&amp;#xa;    image: nginx:alpine&amp;#xa;    container_name: nginx&amp;#xa;    restart: unless-stopped&amp;#xa;    tty: true&amp;#xa;    ports:&amp;#xa;      - &amp;quot;8080:80&amp;quot;&amp;#xa;      - &amp;quot;8443:443&amp;quot;&amp;#xa;    volumes:&amp;#xa;      - ./nginx/conf.d/:/etc/nginx/conf.d/&amp;#xa;      - ./nginx/ssl/:/etc/nginx/ssl/&amp;#xa;    networks:&amp;#xa;      - mynet&amp;#xa;#Docker Networks&amp;#xa;networks:&amp;#xa;  mynet:&amp;#xa;    driver: bridge&amp;#xa;#Volumes&amp;#xa;volumes:&amp;#xa;  registrydata:&amp;#xa;    driver: local&amp;#xa;EOL&amp;#xa;&amp;#xa;&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}docker-compose.yml created successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create docker-compose.yml.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;cd nginx/conf.d/&amp;#xa;&amp;#xa;&amp;#xa;# Create registry.conf using nano&amp;#xa;cat &amp;lt;&amp;lt;EOL &amp;gt; /etc/nginx/sites-available/$domain_name.conf&amp;#xa;&amp;#xa;&amp;#xa;server {&amp;#xa;    listen 443 ssl;&amp;#xa;    server_name www.$domain_name $domain_name;&amp;#xa;&amp;#xa;&amp;#xa;    ssl_certificate /etc/letsencrypt/live/$domain_name/fullchain.pem; &amp;#xa;    ssl_certificate_key /etc/letsencrypt/live/$domain_name/privkey.pem; &amp;#xa;&amp;#xa;&amp;#xa;    location / {&amp;#xa;        proxy_pass http://localhost:5000;&amp;#xa;        proxy_set_header Host \\$host;&amp;#xa;        proxy_set_header X-Real-IP \\$remote_addr;&amp;#xa;        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;&amp;#xa;        proxy_set_header X-Forwarded-Proto \\$scheme;&amp;#xa;    }&amp;#xa;}&amp;#xa;EOL&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}$domain_name.conf created successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create $domain_name.conf.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;sudo ln -s /etc/nginx/sites-available/$domain_name.conf /etc/nginx/sites-enabled/&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}$domain_name.conf SOFTLINK successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create SOFTLINK $domain_name.conf.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;if sudo nginx -t; then&amp;#xa;    echo -e &amp;quot;${GREEN}nginx configuration is correct${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${YELLOW}nginx configuratin error${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;if sudo systemctl restart nginx; then&amp;#xa;    echo -e &amp;quot;${GREEN}nginx restarted successfully${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${YELLOW}nginx restart failed${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Create additional.conf using nano&amp;#xa;cat &amp;lt;&amp;lt;EOL &amp;gt; additional.conf&amp;#xa;client_max_body_size 2G;&amp;#xa;EOL&amp;#xa;&amp;#xa;&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}additional.conf created successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create additional.conf.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;cd .. || exit 1&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...the ssl files are copying...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Copy SSL files&amp;#xa;sudo cp /etc/letsencrypt/live/$domain_name/fullchain.pem ssl/ || {&amp;#xa;    echo -e &amp;quot;${RED}Failed to copy fullchain.pem.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;}&amp;#xa;&amp;#xa;&amp;#xa;sudo cp /etc/letsencrypt/live/$domain_name/privkey.pem ssl/ || {&amp;#xa;    echo -e &amp;quot;${RED}Failed to copy privkey.pem.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;}&amp;#xa;&amp;#xa;&amp;#xa;#cd registry/auth&amp;#xa;cd .. || exit 1&amp;#xa;cd auth&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...installing apache2-utils...${NC}&amp;quot;&amp;#xa;sudo apt install -y apache2-utils || {&amp;#xa;    echo -e &amp;quot;${RED}Failed to install apache2-utils.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;}&amp;#xa;&amp;#xa;&amp;#xa;# Set the password using htpasswd&amp;#xa;#password=&amp;#39;Password^123&amp;#39;&amp;#xa;htpasswd -Bc registry.passwd admin&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;cd .. || exit 1&amp;#xa;&amp;#xa;&amp;#xa;# Create rootCA.crt&amp;#xa;sudo openssl x509 -in /etc/letsencrypt/live/$domain_name/fullchain.pem -inform PEM -out rootCA.crt&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}rootCA.crt created successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create rootCA.crt.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Copy rootCA.crt to Docker certificates directory&amp;#xa;sudo mkdir -p /etc/docker/certs.d/$domain_name/&amp;#xa;sudo cp rootCA.crt /etc/docker/certs.d/$domain_name/&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}rootCA.crt copied to Docker certificates directory.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to copy rootCA.crt to Docker certificates directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Copying rootCA.crt to extra CA certificates directory...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Copy rootCA.crt to extra CA certificates directory&amp;#xa;sudo mkdir -p /usr/share/ca-certificates/extra/&amp;#xa;sudo cp rootCA.crt /usr/share/ca-certificates/extra/&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}rootCA.crt copied to extra CA certificates directory.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to copy rootCA.crt to extra CA certificates directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Reconfigure CA certificates&amp;#xa;sudo dpkg-reconfigure --frontend noninteractive ca-certificates&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}CA certificates reconfigured successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to reconfigure CA certificates.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Restarting Docker service...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Restart Docker service&amp;#xa;sudo systemctl restart docker&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}Docker service restarted successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to restart Docker service.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;sudo usermod -aG docker $USER&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...the docker compose starting...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Start Docker Compose&amp;#xa;&amp;#xa;&amp;#xa;sudo docker-compose up -d&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}Docker Compose started successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to start Docker Compose.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Checking Docker Compose status...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Check Docker Compose status&amp;#xa;sudo docker-compose ps&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}Docker Compose is running.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Docker Compose is not running.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;# Pull Python image&amp;#xa;sudo docker pull python:alpine&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}Python image pulled successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to pull Python image.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Tagging the Python image...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Tag the Python image&amp;#xa;sudo docker images&amp;#xa;sudo docker tag python:alpine $domain_name/python:v2&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}Python image tagged successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to tag Python image.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Logging in to the private registry...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Update package information&amp;#xa;if ! sudo apt update; then&amp;#xa;    echo -e &amp;quot;${RED}The system update failed.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Log in to the private registry&amp;#xa;sudo docker login https://$domain_name&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}Logged in to the private registry.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to log in to the private registry.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Pushing the tagged PHP image to the private registry...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;#tag the image with private repo&amp;#xa;#sudo docker tag php:latest $domain_name/python:v2&amp;#xa;&amp;#xa;&amp;#xa;# Push the tagged PHP image to the private registry&amp;#xa;sudo docker push $domain_name/python:v2&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}PHP image pushed to the private registry successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to push PHP image to the private registry.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${GREEN}Successfully created private repository...${NC}&amp;quot;\&quot; link=\&quot;#!/bin/bash&amp;#xa;&amp;#xa;&amp;#xa;#This script is used to create private docker repository in ubuntu 20.04 ec2 instance&amp;#xa;#Run this sctript with sudo permissions ( sudo su)&amp;#xa;&amp;#xa;&amp;#xa;RED=&amp;#39;\\033[0;31m&amp;#39;  # Red colored text&amp;#xa;NC=&amp;#39;\\033[0m&amp;#39;      # Normal text&amp;#xa;YELLOW=&amp;#39;\\033[33m&amp;#39;  # Yellow Color&amp;#xa;GREEN=&amp;#39;\\033[32m&amp;#39;   # Green Color&amp;#xa;&amp;#xa;&amp;#xa;if [ &amp;quot;$(id -u)&amp;quot; -ne 0 ]; then&amp;#xa;    echo &amp;quot;Error: This script must be run as root&amp;quot; &amp;gt;&amp;amp;2&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo &amp;quot;Enter the Domain_name:&amp;quot;&amp;#xa;read -r domain_name&amp;#xa;#password=&amp;quot;your_password_here&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}... updating packages${NC}&amp;quot;&amp;#xa;# Update package information&amp;#xa;if ! sudo apt update; then&amp;#xa;    echo -e &amp;quot;${RED}The system update failed.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Check if Docker is installed&amp;#xa;if [ -x &amp;quot;$(command -v docker)&amp;quot; ]; then&amp;#xa;    echo &amp;quot;${GREEN}Docker is already installed.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    # Install Docker&amp;#xa;    echo -e &amp;quot;${YELLOW}Installing Docker...${NC}&amp;quot;&amp;#xa;    sudo apt-get update&amp;#xa;    sudo apt-get install -y docker.io&amp;#xa;    if ! [ -x &amp;quot;$(command -v docker)&amp;quot; ]; then&amp;#xa;        echo -e &amp;quot;${RED}Docker installation failed.${NC}&amp;quot;&amp;#xa;        exit 1&amp;#xa;    else&amp;#xa;        echo &amp;quot;${GREEN}Docker is successfully installed.${NC}&amp;quot;&amp;#xa;    fi&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...checking the docker is running successfully or not...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Check if Docker is running&amp;#xa;if sudo systemctl is-active --quiet docker; then&amp;#xa;    echo &amp;quot;${GREEN}Docker is running.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    # Start Docker&amp;#xa;    echo &amp;quot;${YELLOW}Starting Docker...${NC}&amp;quot;&amp;#xa;    sudo systemctl start docker&amp;#xa;    sudo systemctl enable docker&amp;#xa;    if [ $? -eq 0 ]; then&amp;#xa;        echo -e &amp;quot;${GREEN}Docker Successfully started.${NC}&amp;quot;&amp;#xa;    else&amp;#xa;        echo -e &amp;quot;${RED}Docker Failed to start.${NC}&amp;quot;&amp;#xa;        exit 1&amp;#xa;    fi&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...configuring the docker daemon.json...${NC}&amp;quot;&amp;#xa;# Configure Docker daemon&amp;#xa;if ! sudo bash -c &amp;quot;cat &amp;lt;&amp;lt;EOL &amp;gt; /etc/docker/daemon.json&amp;#xa;{&amp;#xa;  \\&amp;quot;insecure-registries\\&amp;quot;: [\\&amp;quot;$domain_name\\&amp;quot;]&amp;#xa;}&amp;#xa;EOL&amp;quot;; then&amp;#xa;    echo -e &amp;quot;${RED}The Docker daemon configuration failed.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...restarting the docker...${NC}&amp;quot;&amp;#xa;# Restart Docker&amp;#xa;if ! sudo systemctl restart docker; then&amp;#xa;    echo -e &amp;quot;${RED}Failed to restart Docker after modifying the daemon.json.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...Installing Certbot and its Nginx plugin${NC}&amp;quot;&amp;#xa;if ! sudo apt install -y certbot python3-certbot-nginx; then &amp;#xa;    echo -e &amp;quot;${RED}Package installation failed.${NC}&amp;quot;&amp;#xa;    echo -e &amp;quot;${RED}Please check the error message above for more details.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;sudo certbot certonly --nginx --email saranyasreedharan23@gmail.com --agree-tos --eff-email -d $domain_name&amp;#xa;#sudo certbot certonly --nginx --email saranyasreedharan23@gmail.com --agree-tos --eff-email -d sr6.mnserviceproviders.com&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...updating the system...${NC}&amp;quot;&amp;#xa;if ! sudo apt update; then&amp;#xa;  echo -e &amp;quot;${RED}System update failed.${NC}&amp;quot;&amp;#xa;  exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...installing the docker-compose...${NC}&amp;quot;&amp;#xa;if ! sudo apt install -y docker-compose; then &amp;#xa;  echo -e &amp;quot;${RED}Failed to install Docker Compose.${NC}&amp;quot;&amp;#xa;  exit 1&amp;#xa;else&amp;#xa;  echo -e &amp;quot;${GREEN}Docker Compose successfully installed.${NC}&amp;quot;&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Creating directories...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Create the &amp;#39;registry&amp;#39; directory&amp;#xa;mkdir -p registry&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}&amp;#39;registry&amp;#39; directory created.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create &amp;#39;registry&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Move into the &amp;#39;registry&amp;#39; directory&amp;#xa;cd registry&amp;#xa;if [ $? -ne 0 ]; then&amp;#xa;    echo -e &amp;quot;${RED}Failed to navigate to &amp;#39;registry&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Create the &amp;#39;auth&amp;#39; directory&amp;#xa;mkdir auth&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}&amp;#39;auth&amp;#39; directory created.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create &amp;#39;auth&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Create the &amp;#39;nginx&amp;#39; directory&amp;#xa;mkdir nginx&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}&amp;#39;nginx&amp;#39; directory created.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create &amp;#39;nginx&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Move into the &amp;#39;nginx&amp;#39; directory&amp;#xa;cd nginx&amp;#xa;if [ $? -ne 0 ]; then&amp;#xa;    echo -e &amp;quot;${RED}Failed to navigate to &amp;#39;nginx&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Create the &amp;#39;conf.d&amp;#39; directory&amp;#xa;mkdir conf.d&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}&amp;#39;conf.d&amp;#39; directory created.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create &amp;#39;conf.d&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Create the &amp;#39;ssl&amp;#39; directory&amp;#xa;mkdir ssl&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}&amp;#39;ssl&amp;#39; directory created.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create &amp;#39;ssl&amp;#39; directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;cd .. || exit 1&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Creating docker-compose.yml...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Create docker-compose.yml using nano&amp;#xa;cat &amp;lt;&amp;lt;EOL &amp;gt; docker-compose.yml&amp;#xa;version: &amp;#39;3&amp;#39;&amp;#xa;services:&amp;#xa;#Registry&amp;#xa;  registry:&amp;#xa;    image: registry:2&amp;#xa;    restart: always&amp;#xa;    ports:&amp;#xa;    - &amp;quot;5000:5000&amp;quot;&amp;#xa;    environment:&amp;#xa;      REGISTRY_AUTH: htpasswd&amp;#xa;      REGISTRY_AUTH_HTPASSWD_REALM: Registry-Realm&amp;#xa;      REGISTRY_AUTH_HTPASSWD_PATH: /auth/registry.passwd&amp;#xa;      REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY: /data&amp;#xa;    volumes:&amp;#xa;      - registrydata:/data&amp;#xa;      - ./auth:/auth&amp;#xa;    networks:&amp;#xa;      - mynet&amp;#xa;#Nginx Service&amp;#xa;  nginx:&amp;#xa;    image: nginx:alpine&amp;#xa;    container_name: nginx&amp;#xa;    restart: unless-stopped&amp;#xa;    tty: true&amp;#xa;    ports:&amp;#xa;      - &amp;quot;8080:80&amp;quot;&amp;#xa;      - &amp;quot;8443:443&amp;quot;&amp;#xa;    volumes:&amp;#xa;      - ./nginx/conf.d/:/etc/nginx/conf.d/&amp;#xa;      - ./nginx/ssl/:/etc/nginx/ssl/&amp;#xa;    networks:&amp;#xa;      - mynet&amp;#xa;#Docker Networks&amp;#xa;networks:&amp;#xa;  mynet:&amp;#xa;    driver: bridge&amp;#xa;#Volumes&amp;#xa;volumes:&amp;#xa;  registrydata:&amp;#xa;    driver: local&amp;#xa;EOL&amp;#xa;&amp;#xa;&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}docker-compose.yml created successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create docker-compose.yml.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;cd nginx/conf.d/&amp;#xa;&amp;#xa;&amp;#xa;# Create registry.conf using nano&amp;#xa;cat &amp;lt;&amp;lt;EOL &amp;gt; /etc/nginx/sites-available/$domain_name.conf&amp;#xa;&amp;#xa;&amp;#xa;server {&amp;#xa;    listen 443 ssl;&amp;#xa;    server_name www.$domain_name $domain_name;&amp;#xa;&amp;#xa;&amp;#xa;    ssl_certificate /etc/letsencrypt/live/$domain_name/fullchain.pem; &amp;#xa;    ssl_certificate_key /etc/letsencrypt/live/$domain_name/privkey.pem; &amp;#xa;&amp;#xa;&amp;#xa;    location / {&amp;#xa;        proxy_pass http://localhost:5000;&amp;#xa;        proxy_set_header Host \\$host;&amp;#xa;        proxy_set_header X-Real-IP \\$remote_addr;&amp;#xa;        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;&amp;#xa;        proxy_set_header X-Forwarded-Proto \\$scheme;&amp;#xa;    }&amp;#xa;}&amp;#xa;EOL&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}$domain_name.conf created successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create $domain_name.conf.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;sudo ln -s /etc/nginx/sites-available/$domain_name.conf /etc/nginx/sites-enabled/&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}$domain_name.conf SOFTLINK successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create SOFTLINK $domain_name.conf.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;if sudo nginx -t; then&amp;#xa;    echo -e &amp;quot;${GREEN}nginx configuration is correct${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${YELLOW}nginx configuratin error${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;if sudo systemctl restart nginx; then&amp;#xa;    echo -e &amp;quot;${GREEN}nginx restarted successfully${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${YELLOW}nginx restart failed${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Create additional.conf using nano&amp;#xa;cat &amp;lt;&amp;lt;EOL &amp;gt; additional.conf&amp;#xa;client_max_body_size 2G;&amp;#xa;EOL&amp;#xa;&amp;#xa;&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}additional.conf created successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create additional.conf.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;cd .. || exit 1&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...the ssl files are copying...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Copy SSL files&amp;#xa;sudo cp /etc/letsencrypt/live/$domain_name/fullchain.pem ssl/ || {&amp;#xa;    echo -e &amp;quot;${RED}Failed to copy fullchain.pem.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;}&amp;#xa;&amp;#xa;&amp;#xa;sudo cp /etc/letsencrypt/live/$domain_name/privkey.pem ssl/ || {&amp;#xa;    echo -e &amp;quot;${RED}Failed to copy privkey.pem.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;}&amp;#xa;&amp;#xa;&amp;#xa;#cd registry/auth&amp;#xa;cd .. || exit 1&amp;#xa;cd auth&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...installing apache2-utils...${NC}&amp;quot;&amp;#xa;sudo apt install -y apache2-utils || {&amp;#xa;    echo -e &amp;quot;${RED}Failed to install apache2-utils.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;}&amp;#xa;&amp;#xa;&amp;#xa;# Set the password using htpasswd&amp;#xa;#password=&amp;#39;Password^123&amp;#39;&amp;#xa;htpasswd -Bc registry.passwd admin&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;&amp;#xa;cd .. || exit 1&amp;#xa;&amp;#xa;&amp;#xa;# Create rootCA.crt&amp;#xa;sudo openssl x509 -in /etc/letsencrypt/live/$domain_name/fullchain.pem -inform PEM -out rootCA.crt&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}rootCA.crt created successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to create rootCA.crt.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Copy rootCA.crt to Docker certificates directory&amp;#xa;sudo mkdir -p /etc/docker/certs.d/$domain_name/&amp;#xa;sudo cp rootCA.crt /etc/docker/certs.d/$domain_name/&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}rootCA.crt copied to Docker certificates directory.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to copy rootCA.crt to Docker certificates directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Copying rootCA.crt to extra CA certificates directory...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Copy rootCA.crt to extra CA certificates directory&amp;#xa;sudo mkdir -p /usr/share/ca-certificates/extra/&amp;#xa;sudo cp rootCA.crt /usr/share/ca-certificates/extra/&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}rootCA.crt copied to extra CA certificates directory.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to copy rootCA.crt to extra CA certificates directory.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Reconfigure CA certificates&amp;#xa;sudo dpkg-reconfigure --frontend noninteractive ca-certificates&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}CA certificates reconfigured successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to reconfigure CA certificates.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Restarting Docker service...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Restart Docker service&amp;#xa;sudo systemctl restart docker&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}Docker service restarted successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to restart Docker service.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;sudo usermod -aG docker $USER&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}...the docker compose starting...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Start Docker Compose&amp;#xa;&amp;#xa;&amp;#xa;sudo docker-compose up -d&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}Docker Compose started successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to start Docker Compose.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Checking Docker Compose status...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Check Docker Compose status&amp;#xa;sudo docker-compose ps&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}Docker Compose is running.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Docker Compose is not running.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;# Pull Python image&amp;#xa;sudo docker pull python:alpine&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}Python image pulled successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to pull Python image.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Tagging the Python image...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Tag the Python image&amp;#xa;sudo docker images&amp;#xa;sudo docker tag python:alpine $domain_name/python:v2&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}Python image tagged successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to tag Python image.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Logging in to the private registry...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;# Update package information&amp;#xa;if ! sudo apt update; then&amp;#xa;    echo -e &amp;quot;${RED}The system update failed.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;# Log in to the private registry&amp;#xa;sudo docker login https://$domain_name&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}Logged in to the private registry.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to log in to the private registry.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${YELLOW}Pushing the tagged PHP image to the private registry...${NC}&amp;quot;&amp;#xa;&amp;#xa;&amp;#xa;#tag the image with private repo&amp;#xa;#sudo docker tag php:latest $domain_name/python:v2&amp;#xa;&amp;#xa;&amp;#xa;# Push the tagged PHP image to the private registry&amp;#xa;sudo docker push $domain_name/python:v2&amp;#xa;if [ $? -eq 0 ]; then&amp;#xa;    echo -e &amp;quot;${GREEN}PHP image pushed to the private registry successfully.${NC}&amp;quot;&amp;#xa;else&amp;#xa;    echo -e &amp;quot;${RED}Failed to push PHP image to the private registry.${NC}&amp;quot;&amp;#xa;    exit 1&amp;#xa;fi&amp;#xa;&amp;#xa;&amp;#xa;echo -e &amp;quot;${GREEN}Successfully created private repository...${NC}&amp;quot;\&quot; id=\&quot;FgjHH_AWDl7wLQwdKiXT-2\&quot;&gt;\n          &lt;mxCell style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n            &lt;mxGeometry y=\&quot;290\&quot; width=\&quot;700\&quot; height=\&quot;7520\&quot; as=\&quot;geometry\&quot; /&gt;\n          &lt;/mxCell&gt;\n        &lt;/UserObject&gt;\n        &lt;mxCell id=\&quot;FgjHH_AWDl7wLQwdKiXT-3\&quot; value=\&quot;\&quot; style=\&quot;endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;FgjHH_AWDl7wLQwdKiXT-1\&quot;&gt;\n          &lt;mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;400\&quot; y=\&quot;330\&quot; as=\&quot;sourcePoint\&quot; /&gt;\n            &lt;mxPoint x=\&quot;190\&quot; y=\&quot;210\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;FgjHH_AWDl7wLQwdKiXT-4\&quot; value=\&quot;run this bash script to create docker private repo\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot; parent=\&quot;FgjHH_AWDl7wLQwdKiXT-3\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-0.1064\&quot; y=\&quot;2\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint as=\&quot;offset\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;FgjHH_AWDl7wLQwdKiXT-5\&quot; value=\&quot;while setting the private docker repo. It will prompt user to set the password\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;80\&quot; y=\&quot;210\&quot; width=\&quot;250\&quot; height=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;FgjHH_AWDl7wLQwdKiXT-6\&quot; value=\&quot;\&quot; style=\&quot;endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.299;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;FgjHH_AWDl7wLQwdKiXT-5\&quot; target=\&quot;FgjHH_AWDl7wLQwdKiXT-2\&quot;&gt;\n          &lt;mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;400\&quot; y=\&quot;250\&quot; as=\&quot;sourcePoint\&quot; /&gt;\n            &lt;mxPoint x=\&quot;450\&quot; y=\&quot;200\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n      &lt;/root&gt;\n    &lt;/mxGraphModel&gt;\n  &lt;/diagram&gt;\n&lt;/mxfile&gt;\n&quot;}"></div>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
</body>
</html>